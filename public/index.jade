extends _layout
include _shared/posts

block main
  .home
    img.avatar.aside(src="http://www.gravatar.com/avatar/9fe1649090216341429d39f2425a7d5c.png?s=256")
    .bio
      :markdown
        I'm **Eric Drechsel** &mdash;
        a multiclass creative professional with deep roots in the web and open source, 
        a focus on user experience, education in math modeling and statistical methods,
        and an immense curiousity and propensity for diving in with new and challenging topics. 
    .activityStream
      h2
        a.source(href="https://zapier.com/engine/rss/196193/activity/")
          mixin icon("rss", nil, true)
        |  Aggregated activity
      ul.fa-ul
      a.more(href)
        i.fa.fa-ellipsis-h
    h2 Featured Articles
    .articles
      each post in posts_array(public.articles._data)
        mixin post_summary(post, post.slug, '/articles')

block footer

block scripts
  script(type='text/javascript').
    function renderActivityStream(roots, limit) {
      $.get("https://zapier.com/engine/rss/196193/activity/", function (data) {
        var items = $(data).find("item").slice(0,limit).map(function () { 
          var el = $(this);
          // TODO: 
          // - use post URL regex to set source
          // 
          return {
            title: el.find("title").text(),
            link: el.find("link").text(),
            description: el.find("description").text(),
            author: el.find("creator").text(),
            date: el.find("pubDate").text(),
            source: el.find('link').text().replace(/^https?:\/\/([a-z.]+\.)?([a-z]+)\.[a-z]+\/.*/,"$2")
          }
        }).get();
        var tpl = '<% _.forEach(items, function(i) { %><li><a href="<%- i.link %>" title="<%- i.source %> - <%- new Date(i.date).toDateString() %>"><i class="fa fa-li fa-<%- i.source %>"></i><%- i.title %></a></li><% }); %>';
        
        roots.html(_.template(tpl, { items: items }))
      });
    }
    (function() {
      var roots = $('.activityStream')
      renderActivityStream(roots.children('ul'), 3)
      roots.children('.more').click(function(event){
        event.preventDefault();
        renderActivityStream($( this ).siblings('ul'));
        $(this).hide()
      });
    }())
